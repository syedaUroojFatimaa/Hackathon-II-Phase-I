# Data Model: In-Memory Python Console Todo App

**Feature**: 001-console-todo-app
**Date**: 2026-01-06
**Phase**: Phase 1 - Data Model Design

## Purpose

Define the data entities, their attributes, validation rules, and state transitions for the console todo application. This model serves as the single source of truth for data structure across all layers.

## Entities

### Todo

**Description**: Represents a single task item in the todo list.

**Attributes**:

| Attribute   | Type | Required | Default   | Description                                    |
|-------------|------|----------|-----------|------------------------------------------------|
| id          | int  | Yes      | Auto      | Unique identifier, auto-generated sequentially |
| title       | str  | Yes      | -         | Task description (non-empty)                   |
| description | str  | No       | ""        | Additional details about the task              |
| status      | str  | Yes      | "pending" | Current state: "pending" or "completed"        |

**Constraints**:
- `id` must be positive integer (>= 1)
- `id` must be unique across all todos in a session
- `title` must be non-empty string (after stripping whitespace)
- `title` has no maximum length (Phase I accepts any length)
- `description` can be empty string
- `description` has no maximum length (Phase I accepts any length)
- `status` must be exactly "pending" or "completed" (case-sensitive)

**Immutability**:
- Todo instances are immutable (frozen dataclass)
- Updates create new Todo instances with modified values
- Original Todo instances are replaced in storage, not mutated

**Python Representation**:
```python
from dataclasses import dataclass

@dataclass(frozen=True)
class Todo:
    id: int
    title: str
    description: str
    status: str  # Literal["pending", "completed"]
```

---

## State Transitions

### Todo Status Lifecycle

```
┌─────────┐
│ pending │ ◄──────────┐
└────┬────┘            │
     │                 │
     │ mark_complete   │ mark_incomplete
     │                 │
     ▼                 │
┌───────────┐          │
│ completed │──────────┘
└───────────┘
```

**Valid Transitions**:
1. `pending → completed`: User marks todo as complete
2. `completed → pending`: User marks todo as incomplete (undo)

**Invalid Transitions**:
- None (all transitions are bidirectional)

**Transition Rules**:
- A todo can be marked complete multiple times (idempotent - no error if already complete)
- A todo can be marked incomplete multiple times (idempotent - no error if already pending)
- Status changes preserve all other attributes (id, title, description)

---

## Validation Rules

### Title Validation

**Rule**: Title must be non-empty after stripping whitespace

**Valid Examples**:
- "Buy groceries"
- "  Call mom  " (stripped to "Call mom")
- "123"
- "!"

**Invalid Examples**:
- "" (empty string)
- "   " (whitespace only)
- None (not a string)

**Error Message**: "Title cannot be empty"

---

### Status Validation

**Rule**: Status must be exactly "pending" or "completed"

**Valid Values**:
- "pending"
- "completed"

**Invalid Values**:
- "Pending" (wrong case)
- "done" (wrong value)
- "in-progress" (not supported in Phase I)
- "" (empty)

**Error Message**: "Status must be 'pending' or 'completed'"

---

### ID Validation

**Rule**: ID must be positive integer

**Valid Values**:
- 1, 2, 3, ... (sequential)

**Invalid Values**:
- 0 (not positive)
- -1 (negative)
- "1" (string, not int)

**Note**: IDs are auto-generated by TodoService, not provided by users. CLI layer validates user input is numeric before passing to service.

---

## Storage Model

### In-Memory Storage Structure

**Type**: `dict[int, Todo]`

**Structure**:
```python
{
    1: Todo(id=1, title="Buy groceries", description="Milk, eggs, bread", status="pending"),
    2: Todo(id=2, title="Call mom", description="", status="completed"),
    3: Todo(id=3, title="Finish report", description="Q4 financial report", status="pending")
}
```

**Key Properties**:
- Key: Todo ID (int)
- Value: Todo instance (immutable)
- Lookup: O(1) by ID
- Iteration: O(n) for all todos
- Memory: ~1KB per todo (estimated)

**ID Generation**:
- Counter starts at 1
- Increments after each add operation
- Never reused (even after deletion)
- Deterministic (sequential)

---

## Data Relationships

### Phase I: No Relationships

In Phase I, todos are independent entities with no relationships:
- No user ownership (single user)
- No categories or tags
- No parent/child relationships
- No dependencies between todos

**Rationale**: Keep Phase I simple and focused on core CRUD operations. Relationships will be added in later phases as needed.

---

## Data Lifecycle

### Creation
1. User provides title and optional description
2. Service validates title (non-empty)
3. Service generates next sequential ID
4. Service creates Todo with status="pending"
5. Service stores Todo in dict
6. Service returns created Todo

### Read
1. User provides ID or requests all todos
2. Service looks up Todo by ID in dict (O(1))
3. Service returns Todo or None if not found

### Update
1. User provides ID and new title/description
2. Service validates ID exists
3. Service validates new title (non-empty)
4. Service creates new Todo with updated values
5. Service replaces old Todo in dict
6. Service returns updated Todo

### Delete
1. User provides ID
2. Service validates ID exists
3. Service removes Todo from dict
4. Service returns success (True) or failure (False)

### Status Change
1. User provides ID and desired status
2. Service validates ID exists
3. Service creates new Todo with updated status
4. Service replaces old Todo in dict
5. Service returns updated Todo

---

## Data Constraints Summary

| Constraint                  | Enforcement Layer | Validation Method          |
|-----------------------------|-------------------|----------------------------|
| Title non-empty             | Service           | Check after strip()        |
| Status valid enum           | Service           | Check against allowed list |
| ID positive integer         | Service           | Auto-generated (always >0) |
| ID unique                   | Service           | Dict key uniqueness        |
| Todo immutable              | Domain            | Dataclass frozen=True      |
| No persistence              | Service           | Dict only (no file I/O)    |

---

## Future Considerations (Phase II+)

**Not in Phase I, but planned for later phases**:
- Timestamps (created_at, updated_at)
- User ownership (user_id foreign key)
- Categories/tags (many-to-many relationship)
- Priority levels (high, medium, low)
- Due dates (datetime field)
- Persistence (database schema)

**Phase I Scope**: Keep data model minimal - only what's needed for core CRUD operations.

---

## References

- Feature Specification: `specs/001-console-todo-app/spec.md`
- Implementation Plan: `specs/001-console-todo-app/plan.md`
- Research: `specs/001-console-todo-app/research.md`
